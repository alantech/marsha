name: Time All

on:
  workflow_dispatch:

jobs:
  time_all:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Call 'time' job for each string
        uses: peter-evans/repository-dispatch@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          repository: ${{ github.repository }}
          event-type: time
          client-payload: '{"test": "${{ matrix.test_string }}"}'
        env:
          TEST_FILES: '["./examples/test/sort_modules.mrsh", "./examples/test/sdata_mangling.mrsh"]'
        run: |
          for TEST_FILE in $TEST_FILES
          do
            echo "Calling 'time' job with 'test' input: $TEST_FILE"
            curl -X POST -H "Authorization: token $GITHUB_TOKEN" -H "Accept: application/vnd.github.everest-preview+json" \
              "https://api.github.com/repos/$GITHUB_REPOSITORY/dispatches" \
              -d '{"event_type": "time", "client_payload": {"test": "'"$TEST_FILE"'"}}'
          done