# Marsha + Jupyter Notebook

> The complete notebook example can be found [here](https://github.com/alantech/marsha/tree/main/examples/data-oriented/notebook)

In a [Jupyter notebook](https://jupyter.org/install) up and running:

- Install `marsha` via pip

```bash
%pip install git+https://github.com/alantech/marsha
```

- Set OpenAI API key

```bash
%env OPENAI_SECRET_KEY=sk-...
```

- Create the `.mrsh` file with the desired definition. In this case, we show how can be defined inline and then saved into a file.

```python
marsha_filename = 'employee_skills.mrsh'
with open(marsha_filename, 'w') as f:
    marsha_content = f'''
# type EmployeesByDepartment ./employees_by_department.csv


# type DepartmentSkills ./department_skills.csv


# type EmployeeSkills
name, skill
Bob, math
Jake, spreadsheets
Lisa, coding
Sue, spreadsheets


# func get_employee_skills(list of EmployeesByDepartment, list of DepartmentSkills): list of EmployeeSkills

This function receives a list of EmployeesByDepartment and a list of DepartmentSkills. 
The function should be able to create a response of EmployeeSkills merging the 2 list by department.
Use the pandas library.

* get_employee_skills() = throws an error
* get_employee_skills([EmployeesByDepartment('Joe', 'Accounting')]) = throws an error
* get_employee_skills([], []) = []
* get_employee_skills([EmployeesByDepartment('Joe', 'Accounting')], []) = []
* get_employee_skills([], [DepartmentSkills('Accounting', 'math')]) = []
* get_employee_skills([EmployeesByDepartment('Joe', 'Accounting')], [DepartmentSkills('Accounting', 'math')]) = [EmployeeSkills('Joe', 'math')]
* get_employee_skills([EmployeesByDepartment('Joe', 'Accounting'), EmployeesByDepartment('Jake', 'Engineering')], [DepartmentSkills('Accounting', 'math')]) = [EmployeeSkills('Joe', 'math')]
* get_employee_skills([EmployeesByDepartment('Joe', 'Accounting'), EmployeesByDepartment('Jake', 'Engineering')], [DepartmentSkills('Accounting', 'math'), DepartmentSkills('Engineering', 'coding')]) = [EmployeeSkills('Joe', 'math'), EmployeeSkills('Jake', 'coding')]


# func read_csv_file(path to file): file data without header

This function read a CSV file and return the csv content without header.


# func process_data(path to file with EmployeesByDepartment, path to file with DepartmentSkills): list of EmployeeSkills

This function uses `read_csv_file` to read the 2 csv files received and create the respective lists. Make sure to strip and lower each string property coming from the csv. Then, call and return the result from `get_employee_skills`.

* process_data('/pathA', '') = throws an error
* process_data('/pathA', '/pathB') = [EmployeeSkills('Joe', 'math')]
* process_data('/pathA', 'pathC') = [EmployeeSkills('Joe', 'math'), EmployeeSkills('Jake', 'coding')]
'''
    f.write(marsha_content)
```

This file is defining a couple of types from the data coming from CSV files, and another type with inline definition, following the CSV format. These types will be translated as classes in the Python-generated code. The files can be found in the repository.

Then it is defining a set of functions trying to follow the single responsibility principle. The functions are reading a couple of CSV files, doing some data manipulation and returning the final result.

- Execute `marsha`

```bash
!python -m marsha ./"$marsha_filename"
```

Marsha generates a Python script, the respective test file for the Python script and the required dependencies.

- To integrate the generated code with the notebook workflow we install the dependencies generated by `marsha`

```bash
%pip install -r requirements.txt
```

- Install `matplotlib` since we will be creating a visualization with the data coming from the generated code

```bash
%pip install matplotlib
```

- Now just import the function and use it to generate the visualisation for the obtained results

```python
import pandas as pd
import matplotlib.pyplot as plt

from employee_skills import process_data

employee_skills_list = process_data('./employees_by_department.csv', './department_skills.csv')
employee_skills_df = pd.DataFrame([(e.name, e.skill) for e in employee_skills_list], columns=["Name", "Skill"])
skill_counts = employee_skills_df["Skill"].value_counts()

plt.figure(figsize=(8, 4))
plt.pie(skill_counts, labels=skill_counts.index, autopct="%1.1f%%")
plt.title("Employee Skills")
plt.show()
```

> The complete notebook example can be found [here](https://github.com/alantech/marsha/tree/main/examples/data-oriented/notebook)
